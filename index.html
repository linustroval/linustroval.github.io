<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>David Ruiz Rodas - Horizon Flight</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        :root {
            --bg-dark: #020202;       
            --card-bg: rgba(5, 10, 20, 0.9);
            --text-main: #ffffff;     
            --text-muted: #94a3b8;    
            --accent: #00f2ff;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        /* LIENZO 3D */
        #canvas-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            /* Degradado más oscuro para simular horizonte profundo */
            background: linear-gradient(to bottom, #020205 0%, #101525 100%);
        }

        /* SCROLL DUMMY (Invisible) */
        #scroll-dummy { height: 6000px; }

        /* PANELES DE INFORMACIÓN (Aparecen al llegar) */
        .info-panel {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            width: 90%; max-width: 850px;
            max-height: 85vh;
            overflow-y: auto;
            opacity: 0;
            pointer-events: none;
            transition: all 0.6s cubic-bezier(0.22, 1, 0.36, 1);
            z-index: 10;
        }

        .info-panel.active {
            opacity: 1;
            pointer-events: auto;
            transform: translate(-50%, -50%) scale(1);
        }

        /* ESTILOS DE TARJETAS */
        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 242, 255, 0.15);
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 0 40px rgba(0,0,0,0.9);
        }

        /* HERO STYLES */
        .hero-title {
            font-size: 4rem; font-weight: 800; margin: 0;
            background: linear-gradient(to right, #fff, #94a3b8);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(0, 242, 255, 0.3);
        }
        .quote {
            margin: 20px auto; font-family: 'JetBrains Mono'; font-style: italic; color: #cbd5e1;
            border-left: 3px solid var(--accent); padding-left: 15px; text-align: left; max-width: 600px;
        }

        /* GENERAL CONTENT */
        h2 { color: var(--accent); border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; margin-top: 0; font-family: 'JetBrains Mono'; }
        .item-header { display: flex; justify-content: space-between; margin-bottom: 5px; flex-wrap: wrap; }
        .item-title { font-weight: 700; font-size: 1.2rem; color: #fff; }
        .item-place { color: #38bdf8; font-weight: 500; }
        
        /* SKILLS */
        .skill-item { margin-bottom: 15px; }
        .skill-bar-bg { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; }
        .skill-bar-fill { height: 100%; background: var(--accent); border-radius: 3px; box-shadow: 0 0 10px var(--accent); }
        .tags { display: flex; flex-wrap: wrap; gap: 8px; list-style: none; padding: 0; }
        .tags li { border: 1px solid rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 4px; font-size: 0.85rem; color: #cbd5e1; }

        /* INDICADOR */
        .scroll-indicator {
            position: fixed; bottom: 40px; width: 100%; text-align: center;
            color: var(--accent); font-family: 'JetBrains Mono'; font-size: 0.9rem;
            animation: pulse 2s infinite; pointer-events: none; z-index: 5;
            text-shadow: 0 0 10px var(--accent);
        }
        @keyframes pulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }

        /* BOTONES */
        .hero-btn {
            display: inline-block; padding: 10px 25px; margin: 10px;
            border: 1px solid var(--accent); color: var(--accent); text-decoration: none;
            font-family: 'JetBrains Mono'; border-radius: 4px; transition: 0.3s;
        }
        .hero-btn:hover { background: var(--accent); color: #000; box-shadow: 0 0 20px var(--accent); }

        /* CSS PARA EL TEXTO 3D (Se usará como textura) */
        /* No visible en el DOM, solo para crear texturas si fuera necesario, pero usaremos Canvas API */

        .profile-pic { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--accent); object-fit: cover; }

    </style>
</head>
<body>

    <div id="canvas-container"></div>
    <div id="scroll-dummy"></div>
    <div class="scroll-indicator">SCROLL TO FLY ▾</div>

    <div class="info-panel active" id="panel-home">
        <div class="glass-card" style="text-align: center;">
            <h1 class="hero-title">David Ruiz Rodas</h1>
            <div style="color:var(--accent); font-family: 'JetBrains Mono'; margin-top: 10px; font-size: 1.2rem;">
                Computational Chemist & Researcher
            </div>
            
            <div class="quote">
                "Nature isn't classical, dammit... make it quantum mechanical." 
                <br><span style="color:#fff; font-size: 0.9rem;">— Richard Feynman</span>
            </div>

            <p style="color: #94a3b8; max-width: 600px; margin: 20px auto;">
                Welcome to my <strong>Potential Energy Surface</strong>. <br>
                Scroll to navigate through the energy barriers of my career.
            </p>

            <div>
                <a href="https://www.linkedin.com/in/david-ruiz-rodas-335914130/" target="_blank" class="hero-btn">LinkedIn</a>
                <a href="https://github.com/linustroval" target="_blank" class="hero-btn">GitHub</a>
            </div>
        </div>
    </div>

    <div class="info-panel" id="panel-education">
        <div class="glass-card">
            <h2>EDUCATION</h2>
            <div class="item-header">
                <span class="item-title">MSc Theoretical Chemistry & Modeling</span>
                <span style="color: var(--accent);">In Progress</span>
            </div>
            <div class="item-place">Universidad Autónoma de Madrid (2024-Present)</div>
            
            <hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 20px 0;">

            <div class="item-header">
                <span class="item-title">BSc in Chemistry</span>
                <span style="color: #94a3b8;">2020-2024</span>
            </div>
            <div class="item-place">Universidad Autónoma de Madrid</div>
            <p style="color: #ccc; font-size: 0.9rem;">Avg Grade: 6.82 | Credits: 240</p>
        </div>
    </div>

    <div class="info-panel" id="panel-experience">
        <div class="glass-card">
            <h2>EXPERIENCE</h2>
            <div class="item-header">
                <span class="item-title">Undergraduate Researcher (TFG)</span>
                <span style="color: var(--accent);">2024</span>
            </div>
            <div class="item-place">IFF-CSIC</div>
            <p style="color: #cbd5e1;">
                Research on <strong>Noble Gas Spectroscopy</strong> using ML potentials and quantum computations.
            </p>
            <div style="background: rgba(0, 242, 255, 0.05); border: 1px solid var(--accent); padding: 10px; border-radius: 6px; font-size: 0.9rem; margin-top: 10px;">
                <strong>Publication (Prep):</strong> "Spectroscopic characterization of proton-bound Kr2H+ molecule"
            </div>
        </div>
    </div>

    <div class="info-panel" id="panel-skills">
        <div class="glass-card">
            <h2>SKILLS & TOOLS</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div>
                    <h3 style="color:#fff; font-size: 1rem; margin-bottom: 15px;">Languages</h3>
                    <div class="skill-item">
                        <div style="display:flex; justify-content:space-between; font-size:0.85rem; margin-bottom:4px;"><span>Fortran</span><span>Adv</span></div>
                        <div class="skill-bar-bg"><div class="skill-bar-fill" style="width: 85%"></div></div>
                    </div>
                    <div class="skill-item">
                        <div style="display:flex; justify-content:space-between; font-size:0.85rem; margin-bottom:4px;"><span>Bash</span><span>Adv</span></div>
                        <div class="skill-bar-bg"><div class="skill-bar-fill" style="width: 80%"></div></div>
                    </div>
                    <div class="skill-item">
                        <div style="display:flex; justify-content:space-between; font-size:0.85rem; margin-bottom:4px;"><span>Python</span><span>Int</span></div>
                        <div class="skill-bar-bg"><div class="skill-bar-fill" style="width: 65%"></div></div>
                    </div>
                </div>
                <div>
                    <h3 style="color:#fff; font-size: 1rem; margin-bottom: 15px;">Software</h3>
                    <ul class="tags">
                        <li>Gaussian</li> <li>Orca</li> <li>Molpro</li> <li>Spartan</li> <li>LaTeX</li> <li>Gnuplot</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="info-panel" id="panel-contact">
        <div class="glass-card" style="text-align: center;">
            <img src="profile.jpg" alt="David" class="profile-pic">
            <h2>CONTACT</h2>
            <p style="color: #cbd5e1; margin-bottom: 25px;">Ready to compute the next big thing?</p>
            <a href="mailto:rrodasdavid@gmail.com" class="hero-btn">Initialize Email</a>
        </div>
    </div>

    <script>
        const scene = new THREE.Scene();
        // Niebla azul oscuro para fundir el horizonte
        scene.fog = new THREE.FogExp2(0x020205, 0.006);

        const camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // --- CREAR PES (TERRENO) ---
        // Usamos muchos segmentos para que las montañas se vean definidas
        const geometry = new THREE.PlaneGeometry(300, 600, 150, 300);
        const pos = geometry.attributes.position;
        const colors = [];
        const color = new THREE.Color();

        // Datos para las montañas (Posición X, Posición Y (en el plano 2d), Altura, Ancho)
        // Nota: En PlaneGeometry Y es la profundidad antes de rotar.
        const peaks = [
            { x: 0, y: 50, h: 25, w: 600, label: "START" }, // Base inicial (no usada para titulo)
            { x: -30, y: 0, h: 40, w: 400, label: "EDUCATION" },
            { x: 30, y: -80, h: 45, w: 450, label: "EXPERIENCE" },
            { x: -25, y: -160, h: 40, w: 400, label: "SKILLS" },
            { x: 0, y: -240, h: 35, w: 400, label: "CONTACT" }
        ];

        for (let i = 0; i < pos.count; i++) {
            const x = pos.getX(i);
            const y = pos.getY(i);
            
            // Ruido base (olas pequeñas)
            let z = Math.sin(x * 0.1) * Math.cos(y * 0.1) * 2;
            z += Math.random() * 0.5;

            // Añadir las montañas definidas en 'peaks'
            peaks.forEach(p => {
                // Función Gaussiana para crear montañas suaves
                const distSq = (x - p.x)**2 + (y - p.y)**2;
                z += p.h * Math.exp(-distSq / p.w);
            });

            pos.setZ(i, z);

            // Colorear (Heatmap Style)
            // Rojo/Blanco arriba (Alta energía), Azul/Negro abajo (Baja energía)
            const heightRatio = Math.max(0, (z - 2) / 40); // Normalizar 0 a 1 aprox
            if(z < 5) {
                color.setHex(0x000022); // Fondo oscuro
            } else {
                // Gradiente Cyan -> Azul -> Blanco
                color.setHSL(0.55 - (heightRatio * 0.2), 1.0, 0.1 + heightRatio * 0.6);
            }
            colors.push(color.r, color.g, color.b);
        }

        geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
        geometry.computeVertexNormals();

        const material = new THREE.MeshBasicMaterial({ 
            vertexColors: true, wireframe: true, transparent: true, opacity: 0.6
        });

        const plane = new THREE.Mesh(geometry, material);
        // Rotar para que esté plano en el suelo (XZ)
        plane.rotation.x = -Math.PI / 2;
        scene.add(plane);

        // --- CREAR TÍTULOS 3D (HOLLYWOOD STYLE) ---
        function createTextTexture(text) {
            const canvas = document.createElement('canvas');
            canvas.width = 1024; canvas.height = 256;
            const ctx = canvas.getContext('2d');
            
            // Fondo transparente
            ctx.fillStyle = 'rgba(0,0,0,0)'; 
            ctx.clearRect(0,0, canvas.width, canvas.height);

            // Texto Neón
            ctx.font = 'bold 120px Arial';
            ctx.textAlign = 'center';
            ctx.fillStyle = '#ffffff';
            ctx.shadowColor = "#00f2ff";
            ctx.shadowBlur = 30;
            ctx.fillText(text, 512, 160);
            
            // Borde (opcional)
            ctx.strokeStyle = '#00f2ff';
            ctx.lineWidth = 4;
            ctx.strokeText(text, 512, 160);

            const tex = new THREE.CanvasTexture(canvas);
            return tex;
        }

        peaks.forEach((p, index) => {
            if(index === 0) return; // Saltar el "start" dummy

            const tex = createTextTexture(p.label);
            const labelMat = new THREE.MeshBasicMaterial({ 
                map: tex, transparent: true, side: THREE.DoubleSide, depthTest: false 
            });
            // Hacemos el cartel grande
            const labelGeo = new THREE.PlaneGeometry(60, 15);
            const labelMesh = new THREE.Mesh(labelGeo, labelMat);

            // Posicionamos el cartel ENCIMA de la montaña
            // Ojo con las coordenadas: en Threejs Y es arriba.
            // Nuestra PES está rotada, así que:
            // PES x = mundo x
            // PES y (profundidad original) = mundo -z
            // PES z (altura calculada) = mundo y
            
            labelMesh.position.set(p.x, p.h + 10, -p.y); // +10 para flotar sobre el pico
            
            // Importante: El cartel debe mirar hacia donde vendrá la cámara
            // Como volamos hacia -Z, el cartel mira hacia +Z (defecto)
            
            scene.add(labelMesh);
            
            // Añadimos una linea vertical ("poste") para que parezca clavado
            const poleGeo = new THREE.BoxGeometry(0.5, 10, 0.5);
            const poleMat = new THREE.MeshBasicMaterial({ color: 0x00f2ff });
            const pole = new THREE.Mesh(poleGeo, poleMat);
            pole.position.set(p.x, p.h + 5, -p.y);
            scene.add(pole);
        });


        // --- WAYPOINTS (RUTA DE VUELO) ---
        // Definimos por dónde pasará la cámara
        const waypoints = [
            // Home (Alto y mirando horizonte)
            { id: 'panel-home', pos: new THREE.Vector3(0, 30, 80), lookAt: new THREE.Vector3(0, 10, -50) },
            
            // Education (Volamos bajo hacia la montaña izquierda)
            { id: 'panel-education', pos: new THREE.Vector3(-15, 25, 20), lookAt: new THREE.Vector3(-30, 40, 0) },
            
            // Experience (Cruzamos hacia la derecha)
            { id: 'panel-experience', pos: new THREE.Vector3(15, 30, 50), lookAt: new THREE.Vector3(30, 45, 80) },
            
            // Skills (Volvemos izq y bajamos más profundo en Z)
            { id: 'panel-skills', pos: new THREE.Vector3(-10, 25, 140), lookAt: new THREE.Vector3(-25, 40, 160) },
            
            // Contact (Final)
            { id: 'panel-contact', pos: new THREE.Vector3(0, 20, 220), lookAt: new THREE.Vector3(0, 35, 240) }
        ];
        
        // CORRECCIÓN DE COORDENADAS DE WAYPOINTS PARA QUE COINCIDAN CON MONTAÑAS
        // Las montañas están en Z negativo (porque en la generación usamos -p.y para posicionar).
        // Montaña Edu: x -30, z 0. Exp: x 30, z 80. Skills: x -25, z 160...
        
        // Vamos a redefinir la ruta para que sea un viaje lineal "hacia adelante" por el cañón
        // Pico 1 (Edu) está en Z = 0 (aprox). Pico 2 (Exp) en Z = 80...
        // La cámara debe estar ANTES del pico mirando hacia él.
        
        const flightPath = [
            { id: 'panel-home', z: 120, x: 0, y: 30,  lookOffset: {x:0, y:-5, z:-50} }, 
            { id: 'panel-education', z: 30, x: -10, y: 20, lookOffset: {x:-20, y:10, z:-40} }, // Mirando al pico Edu (que está en Z=0)
            { id: 'panel-experience', z: -50, x: 10, y: 20, lookOffset: {x:20, y:10, z:-40} }, // Mirando al pico Exp (está en Z=-80)
            { id: 'panel-skills', z: -130, x: -10, y: 20, lookOffset: {x:-15, y:10, z:-40} }, // Mirando al pico Skill (Z=-160)
            { id: 'panel-contact', z: -200, x: 0, y: 25, lookOffset: {x:0, y:5, z:-40} }   // Mirando al pico Contact (Z=-240)
        ];

        function moveCamera() {
            const scrollY = window.scrollY;
            const maxScroll = document.body.scrollHeight - window.innerHeight;
            const scrollPercent = scrollY / maxScroll; // 0 a 1

            // Interpolación entre puntos
            const segmentSize = 1 / (flightPath.length - 1);
            let currentIndex = Math.floor(scrollPercent / segmentSize);
            if (currentIndex >= flightPath.length - 1) currentIndex = flightPath.length - 2;
            
            const nextIndex = currentIndex + 1;
            const segmentProgress = (scrollPercent - (currentIndex * segmentSize)) / segmentSize;

            const p1 = flightPath[currentIndex];
            const p2 = flightPath[nextIndex];

            // Posición Cámara
            camera.position.x = p1.x + (p2.x - p1.x) * segmentProgress;
            camera.position.y = p1.y + (p2.y - p1.y) * segmentProgress;
            camera.position.z = p1.z + (p2.z - p1.z) * segmentProgress;

            // LookAt Dinámico (Miramos siempre un poco adelante)
            // Interpolamos el offset de mirada
            const offX = p1.lookOffset.x + (p2.lookOffset.x - p1.lookOffset.x) * segmentProgress;
            const offY = p1.lookOffset.y + (p2.lookOffset.y - p1.lookOffset.y) * segmentProgress;
            const offZ = p1.lookOffset.z + (p2.lookOffset.z - p1.lookOffset.z) * segmentProgress;

            camera.lookAt(
                camera.position.x + offX, 
                camera.position.y + offY, 
                camera.position.z + offZ
            );

            // ACTIVAR PANELES
            // Si estamos cerca de un punto clave ("parada"), mostramos panel
            // Zona activa: +/- 15% del centro del segmento
            const pointProgress = scrollPercent * (flightPath.length - 1); // 0, 1, 2, 3...
            const closestPoint = Math.round(pointProgress);
            const dist = Math.abs(pointProgress - closestPoint);

            // Ocultar todos
            document.querySelectorAll('.info-panel').forEach(p => p.classList.remove('active'));
            
            if (dist < 0.25) { // Si estamos cerca del waypoint
                const panelId = flightPath[closestPoint].id;
                document.getElementById(panelId).classList.add('active');
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            // Efecto de viento/velocidad en la malla (ondulando suavemente)
            const time = Date.now() * 0.001;
            // No modificamos vértices cada frame por rendimiento, 
            // pero podríamos rotar un poco las nubes o partículas si las hubiera.
            renderer.render(scene, camera);
        }

        window.addEventListener('scroll', moveCamera);
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            moveCamera();
        });

        // Init
        moveCamera();
        animate();

    </script>
</body>
</html>
