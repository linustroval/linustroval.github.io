<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>David Ruiz Rodas - Infinite Horizon</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollToPlugin.min.js"></script>

    <style>
        :root {
            --bg-dark: #010103;       
            --card-bg: rgba(8, 12, 25, 0.85);
            --text-main: #ffffff;     
            --text-muted: #94a3b8;    
            --accent: #00f2ff;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden; /* Importante para el canvas fixed */
        }

        /* LIENZO 3D */
        #canvas-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0;
            cursor: crosshair; /* Puntero de precisión para seleccionar montañas */
        }

        /* BARRA DE SCROLL "FANTASMA" */
        /* Hacemos la página muy larga para navegar */
        #scroll-dummy { height: 8000px; }

        /* INTERFAZ UI (Sobre el 3D) */
        .ui-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* Dejar pasar clics al 3D */
            z-index: 10;
        }

        /* PANELES DE INFORMACIÓN */
        .info-panel {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 90%; max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            opacity: 0;
            pointer-events: none;
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .info-panel.active {
            opacity: 1;
            pointer-events: auto; /* Activar interacción */
            transform: translate(-50%, -50%) scale(1);
        }

        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(0, 242, 255, 0.2);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            position: relative;
        }

        /* Cruz de cierre para los paneles */
        .close-btn {
            position: absolute; top: 20px; right: 20px;
            background: transparent; border: 1px solid var(--accent);
            color: var(--accent); width: 30px; height: 30px; border-radius: 50%;
            cursor: pointer; font-weight: bold; display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .close-btn:hover { background: var(--accent); color: #000; }

        /* ESTILOS DE TEXTO */
        h1 { font-size: 3.5rem; margin: 0; background: linear-gradient(to bottom, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        h2 { font-family: 'JetBrains Mono'; color: var(--accent); border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; margin-top: 0; }
        .quote { font-family: 'JetBrains Mono'; font-style: italic; color: #cbd5e1; border-left: 3px solid var(--accent); padding-left: 15px; margin: 20px 0; }
        
        .item-header { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .item-title { font-weight: 700; color: #fff; font-size: 1.1rem; }
        .item-place { color: #38bdf8; font-size: 0.95rem; }
        
        /* Skills Bars */
        .skill-row { display: flex; align-items: center; margin-bottom: 12px; }
        .skill-name { width: 80px; font-family: 'JetBrains Mono'; font-size: 0.85rem; color: #ccc; }
        .skill-track { flex: 1; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; }
        .skill-fill { height: 100%; background: var(--accent); box-shadow: 0 0 10px var(--accent); }

        /* INSTRUCCIONES FLOTANTES */
        .instructions {
            position: fixed; bottom: 30px; width: 100%; text-align: center;
            color: rgba(255,255,255,0.5); font-family: 'JetBrains Mono'; font-size: 0.8rem;
            pointer-events: none; z-index: 20;
        }

        /* Foto */
        .profile-pic { width: 100px; height: 100px; border-radius: 50%; border: 2px solid var(--accent); object-fit: cover; }
        
        .hero-btn {
            display: inline-block; padding: 10px 25px; margin: 10px;
            border: 1px solid var(--accent); color: var(--accent); text-decoration: none;
            font-family: 'JetBrains Mono'; border-radius: 4px; transition: 0.3s;
        }
        .hero-btn:hover { background: var(--accent); color: #000; box-shadow: 0 0 15px var(--accent); }

    </style>
</head>
<body>

    <div id="canvas-container"></div>
    <div id="scroll-dummy"></div>

    <div class="instructions">SCROLL TO FLY  ///  CLICK MOUNTAINS TO JUMP</div>

    <div class="ui-layer">
        
        <div class="info-panel active" id="panel-home">
            <div class="glass-card" style="text-align: center;">
                <h1>David Ruiz Rodas</h1>
                <div style="font-family: 'JetBrains Mono'; color: var(--accent); margin-top: 10px;">
                    Computational Chemist
                </div>
                
                <div class="quote">
                    "Nature isn't classical, dammit... make it quantum mechanical."
                </div>

                <p style="color: #94a3b8; font-size: 0.95rem;">
                    Welcome to the <strong>Landscape of my Career</strong>.<br>
                    Look at the horizon. Those peaks represent my milestones.<br>
                    <strong>Scroll down</strong> to fly there, or <strong>Click a mountain</strong> to warp.
                </p>

                <div>
                    <a href="https://www.linkedin.com/in/david-ruiz-rodas-335914130/" target="_blank" class="hero-btn">LinkedIn</a>
                    <a href="https://github.com/linustroval" target="_blank" class="hero-btn">GitHub</a>
                </div>
            </div>
        </div>

        <div class="info-panel" id="panel-education">
            <div class="glass-card">
                <button class="close-btn" onclick="closePanel()">×</button>
                <h2>EDUCATION</h2>
                <div class="item-header"><span class="item-title">MSc Theoretical Chemistry</span><span>Present</span></div>
                <div class="item-place">Universidad Autónoma de Madrid</div>
                <hr style="border-color: rgba(255,255,255,0.1); margin: 15px 0;">
                <div class="item-header"><span class="item-title">BSc Chemistry</span><span>2020-2024</span></div>
                <div class="item-place">UAM</div>
                <p style="font-size: 0.85rem; color: #aaa;">Avg Grade: 6.82 | Credits: 240</p>
            </div>
        </div>

        <div class="info-panel" id="panel-experience">
            <div class="glass-card">
                <button class="close-btn" onclick="closePanel()">×</button>
                <h2>EXPERIENCE</h2>
                <div class="item-header"><span class="item-title">Undergraduate Researcher</span><span>2024</span></div>
                <div class="item-place">IFF-CSIC</div>
                <p style="font-size: 0.9rem; color: #ccc;">
                    <strong>Noble Gas Spectroscopy.</strong> Developed machine learned potentials and quantum computations.
                </p>
                <div style="background: rgba(0,242,255,0.05); padding: 10px; border-left: 2px solid var(--accent); font-size: 0.85rem;">
                    Publication: "Spectroscopic characterization of proton-bound Kr2H+" (In Prep)
                </div>
            </div>
        </div>

        <div class="info-panel" id="panel-skills">
            <div class="glass-card">
                <button class="close-btn" onclick="closePanel()">×</button>
                <h2>SKILLS MATRIX</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <div class="skill-row"><span class="skill-name">Fortran</span><div class="skill-track"><div class="skill-fill" style="width:90%"></div></div></div>
                        <div class="skill-row"><span class="skill-name">Bash</span><div class="skill-track"><div class="skill-fill" style="width:85%"></div></div></div>
                        <div class="skill-row"><span class="skill-name">Python</span><div class="skill-track"><div class="skill-fill" style="width:65%"></div></div></div>
                        <div class="skill-row"><span class="skill-name">C</span><div class="skill-track"><div class="skill-fill" style="width:25%"></div></div></div>
                    </div>
                    <div>
                        <div style="font-size: 0.9rem; color: #fff; margin-bottom: 10px;">Software Stack</div>
                        <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                            <span style="border:1px solid #555; padding:3px 8px; border-radius:4px; font-size:0.8rem; color:#ccc;">Gaussian</span>
                            <span style="border:1px solid #555; padding:3px 8px; border-radius:4px; font-size:0.8rem; color:#ccc;">Orca</span>
                            <span style="border:1px solid #555; padding:3px 8px; border-radius:4px; font-size:0.8rem; color:#ccc;">Molpro</span>
                            <span style="border:1px solid #555; padding:3px 8px; border-radius:4px; font-size:0.8rem; color:#ccc;">LaTeX</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="info-panel" id="panel-contact">
            <div class="glass-card" style="text-align: center;">
                <button class="close-btn" onclick="closePanel()">×</button>
                <img src="profile.jpg" alt="David" class="profile-pic">
                <h2>CONTACT</h2>
                <p style="color: #ccc;">Collaboration ready.</p>
                <a href="mailto:rrodasdavid@gmail.com" class="hero-btn">Initialize Email</a>
            </div>
        </div>

    </div>

    <script>
        // --- 1. CONFIGURACIÓN THREE.JS ---
        const scene = new THREE.Scene();
        // Niebla negra progresiva para el horizonte infinito
        scene.fog = new THREE.Fog(0x010103, 100, 1200);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 3000);
        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // --- 2. GENERACIÓN DEL TERRENO (PES INFINITA) ---
        // 400 de ancho, 2000 de largo (profundidad)
        const geometry = new THREE.PlaneGeometry(400, 2000, 100, 500);
        const pos = geometry.attributes.position;
        const colors = [];
        const color = new THREE.Color();

        // Definimos las montañas "Clave" (Donde están las secciones)
        // Z values: negativo es hacia el fondo.
        const peaks = [
            { id: 'start', z: 100, x: 0, h: 0, label: null }, // Inicio
            { id: 'panel-education', z: -300, x: -40, h: 50, label: "EDUCATION" },
            { id: 'panel-experience', z: -700, x: 40, h: 60, label: "EXPERIENCE" },
            { id: 'panel-skills', z: -1100, x: -30, h: 55, label: "SKILLS" },
            { id: 'panel-contact', z: -1500, x: 0, h: 40, label: "CONTACT" }
        ];

        // Esculpir el terreno
        for (let i = 0; i < pos.count; i++) {
            const x = pos.getX(i);
            const y = pos.getY(i); // Y en PlaneGeometry es profundidad antes de rotar
            
            // Terreno base (ondas cuánticas)
            let z = Math.sin(x * 0.05) * Math.cos(y * 0.02) * 5;
            z += Math.random() * 1.5; // Ruido/Rugosidad

            // Levantar las montañas clave
            peaks.forEach(p => {
                if (p.label) {
                    // Gaussian function para crear la montaña en esa posición
                    // Usamos 'y' del loop comparado con 'p.z' porque rotaremos el plano
                    // Nota: En PlaneGeometry sin rotar, Y va de +height/2 a -height/2.
                    // Mapearemos nuestras coordenadas Z deseadas a la geometría.
                    
                    const distSq = (x - p.x)**2 + (y - (-p.z))**2; // -p.z porque Y crece hacia arriba en geo 2D
                    // Ancho de la montaña: 8000
                    z += p.h * Math.exp(-distSq / 8000);
                }
            });

            pos.setZ(i, z);

            // Colorear (Heatmap)
            // Fondo oscuro, Picos Cyan/Blanco
            const heightFactor = Math.max(0, (z - 5) / 50);
            if (z < 8) {
                color.setHex(0x050510); // Valle oscuro
            } else {
                // Gradiente Cyan Electrico
                color.setHSL(0.5, 1.0, 0.1 + heightFactor * 0.9);
            }
            colors.push(color.r, color.g, color.b);
        }

        geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
        geometry.computeVertexNormals();

        const material = new THREE.MeshBasicMaterial({ 
            vertexColors: true, wireframe: true, transparent: true, opacity: 0.5 
        });

        const plane = new THREE.Mesh(geometry, material);
        plane.rotation.x = -Math.PI / 2; // Acostar
        
        // Ajustar posición para que Z=0 sea el inicio visible
        // La geometría mide 2000. El centro es 0. Va de -1000 a 1000.
        // Queremos que nuestras coordenadas Z (-300, -700...) calcen.
        // Si el centro es 0, y queremos ir hacia atrás...
        // Dejémoslo centrado en 0,0,0 y navegamos hacia -Z.
        scene.add(plane);


        // --- 3. CARTELES 3D CLICABLES ---
        const interactables = []; // Array para el Raycaster

        function createLabel(text, x, y, z) {
            const canvas = document.createElement('canvas');
            canvas.width = 512; canvas.height = 128;
            const ctx = canvas.getContext('2d');
            
            ctx.font = 'bold 80px Arial';
            ctx.fillStyle = 'rgba(0, 242, 255, 0.1)'; // Fondo suave
            ctx.fillRect(0,0, 512, 128);
            ctx.strokeStyle = '#00f2ff';
            ctx.lineWidth = 5;
            ctx.strokeRect(0,0, 512, 128);
            
            ctx.fillStyle = 'white';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.shadowColor="cyan"; ctx.shadowBlur=20;
            ctx.fillText(text, 256, 64);

            const tex = new THREE.CanvasTexture(canvas);
            const mat = new THREE.MeshBasicMaterial({ map: tex, transparent: true, side: THREE.DoubleSide });
            const geo = new THREE.PlaneGeometry(60, 15);
            const mesh = new THREE.Mesh(geo, mat);
            
            mesh.position.set(x, y + 15, z); // Flotando sobre el pico
            mesh.name = text; // Para identificarlo al hacer click
            scene.add(mesh);

            // Poste
            const pole = new THREE.Mesh(
                new THREE.BoxGeometry(0.5, 15, 0.5),
                new THREE.MeshBasicMaterial({color: 0x00f2ff})
            );
            pole.position.set(x, y + 7.5, z);
            scene.add(pole);

            return mesh;
        }

        peaks.forEach(p => {
            if(p.label) {
                const mesh = createLabel(p.label, p.x, p.h, p.z);
                // Guardamos referencia: malla 3D -> ID del panel HTML
                mesh.userData = { targetId: p.id, scrollZ: p.z };
                interactables.push(mesh);
            }
        });


        // --- 4. CÁMARA Y MOVIMIENTO ---
        
        // Posición inicial: Alta y atrás para ver todo el panorama
        camera.position.set(0, 60, 200);
        camera.lookAt(0, 0, -500);

        function updateCameraScroll() {
            // Mapear scroll HTML (0 a max) a coordenadas Z del mundo (200 a -1500)
            const scrollY = window.scrollY;
            const maxScroll = document.body.scrollHeight - window.innerHeight;
            const progress = scrollY / maxScroll; // 0 a 1

            // Definimos el rango de vuelo
            const startZ = 200;
            const endZ = -1600;
            
            const currentZ = startZ + (endZ - startZ) * progress;
            
            // Posición de la cámara
            camera.position.z = currentZ;
            
            // Altura dinámica: Alta al principio, baja cuando entramos en el terreno
            // Si Z > 0 (Inicio), altura 60. Si Z < 0, altura 30.
            let targetY = 30;
            if (currentZ > 0) targetY = 60 - (30 * (1 - (currentZ/200))); // Transición suave
            
            // Seguir el terreno (Opcional, hace que suba si hay montaña debajo)
            // Simplificado: Oscilación suave + Base
            camera.position.y = targetY + Math.sin(currentZ * 0.01) * 2;
            
            // Movimiento lateral (X) suave para dar sensación de vuelo curvo
            camera.position.x = Math.sin(currentZ * 0.002) * 20;

            // LookAt: Siempre mirando adelante
            camera.lookAt(camera.position.x * 0.5, 10, currentZ - 200);

            checkProximity(currentZ);
        }

        // --- 5. LOGICA DE PANELES (Proximidad) ---
        function checkProximity(camZ) {
            // Si no estamos clicando (scroll manual), verificar distancia a picos
            // Ocultar home si bajamos
            if (window.scrollY > 100) document.getElementById('panel-home').classList.remove('active');
            else document.getElementById('panel-home').classList.add('active');

            peaks.forEach(p => {
                if (!p.label) return;
                const panel = document.getElementById(p.id);
                // Distancia Z
                const dist = Math.abs(camZ - (p.z + 50)); // +50 offset para parar ANTES del cartel
                
                if (dist < 80) { // Si estamos a menos de 80 unidades
                    panel.classList.add('active');
                } else {
                    // No ocultamos automáticamente si el usuario lo abrió manualmente, 
                    // pero para simplificar flujo de scroll, sí:
                    // panel.classList.remove('active'); 
                    // (Opcional: Dejamos que el usuario cierre con la X)
                }
            });
        }

        function closePanel() {
            document.querySelectorAll('.info-panel').forEach(p => p.classList.remove('active'));
        }


        // --- 6. INTERACCIÓN (RAYCASTER - CLIC EN MONTAÑAS) ---
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        window.addEventListener('click', (event) => {
            // Convertir ratón a coordenadas normalizadas (-1 a +1)
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);

            // Ver si chocamos con algún cartel
            const intersects = raycaster.intersectObjects(interactables);

            if (intersects.length > 0) {
                const target = intersects[0].object;
                const targetZ = target.userData.scrollZ;
                
                // Calcular cuánto scroll corresponde a esa Z
                // startZ = 200, endZ = -1600. Total range = 1800.
                // Formula inversa del updateCameraScroll
                const totalDist = 1800;
                const distFromStart = 200 - (targetZ + 60); // +60 para parar un poco antes
                const scrollPercent = distFromStart / totalDist;
                
                const maxScroll = document.body.scrollHeight - window.innerHeight;
                const scrollToPixel = scrollPercent * maxScroll;

                // Animar scroll con GSAP
                gsap.to(window, {duration: 2, scrollTo: scrollToPixel, ease: "power2.inOut"});
                
                // Abrir panel correspondiente
                closePanel();
                setTimeout(() => {
                   document.getElementById(target.userData.targetId).classList.add('active'); 
                }, 1500);
            }
        });


        // --- 7. ANIMATION LOOP ---
        function animate() {
            requestAnimationFrame(animate);
            // Vibración malla
            plane.geometry.attributes.position.needsUpdate = true;
            renderer.render(scene, camera);
        }

        window.addEventListener('scroll', updateCameraScroll);
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            updateCameraScroll();
        });

        animate();
        updateCameraScroll(); // Init pos

    </script>
</body>
</html>
